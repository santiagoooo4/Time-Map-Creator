<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ğŸµ Tempo Map Creator PRO v4</title>
    <meta name="viewport" content="width=900, initial-scale=1">
    <link rel="stylesheet" href="/css/estilos.css">
</head>
<body>
    <header>
        <h1>ğŸµ Tempo Map Creator PRO</h1>
        <div class="subtitle">MedÃ­ BPM, exporta, importa, promedia y gestiona marcas como Pro</div>
    </header>

    <section class="top-bar">
        <div class="inputs-row">
            <label><span>Audio:</span> <input type="file" id="file" accept="audio/*"></label>
            <label><span>MetrÃ³nomo:</span> <input type="file" id="clickFile" accept="audio/*"></label>
            <label><span>Input Lag (seg):</span> <input type="number" id="lagInput" class="lag-input" value="0.000" min="-5" max="5" step="0.001" autocomplete="off"></label>
            <label><span>Cifra de compÃ¡s:</span> <input type="number" min="1" step="1" id="cifraCompas" value="4"></label>
        </div>
        <div class="file-buttons-row">
            <input type="file" id="importCsv" accept=".csv" style="display:none;">
            <button id="importBtn">ğŸ“¥ Importar CSV</button>
            <input type="file" id="multiImportCsv" accept=".csv" multiple style="display:none;">
            <button id="importMultiBtn">ğŸ“¥ Promediar CSVs</button>
            <button id="export" disabled>ğŸ’¾ Exportar CSV</button>
            <button id="exportAvgBtn" disabled>ğŸ’¾ Exportar Promedio</button>
        </div>
    </section>

    <section class="stats-panels">
        <div class="tap-tempo-box" id="tapTempoBtn" title="AÃ±adir marca al tempo actual mediante tap">
            <span class="tap-tempo-icon">ğŸ¥</span>
            <span class="tap-tempo-label">Tap Tempo</span>
        </div>
        <div class="bpm-panel">
            <span class="bpm-label">BPM Actual</span>
            <span class="bpm-value" id="actualBpmVal">--</span>
        </div>
        <div class="audio-info-panel">
            <div><b>Audio cargado:</b> <span id="fileNameInfo">--</span></div>
            <div><b>DuraciÃ³n original:</b> <span id="origDuration">--</span> s</div>
            <div><b>Recorte inicio:</b> <span id="fragStart">--</span> s</div>
            <div><b>Recorte fin:</b> <span id="fragEnd">--</span> s</div>
        </div>
    </section>

    <section class="tools-bar">
        <b>EdiciÃ³n:</b>
        <button id="normal" class="active">ğŸ–±ï¸ Editar</button>
        <button id="pencil">âœï¸ AÃ±adir (M)</button>
        <button id="eraser">ğŸ§¹ Borrar</button>
        <button id="clearBtn" title="Borrar todas las marcas">ğŸ—‘ï¸ Borrar todas</button>
        <button id="undoBtn" disabled title="Deshacer">â†©ï¸</button>
        <button id="redoBtn" disabled title="Rehacer">â†ªï¸</button>
    </section>

    <main>
        <div class="waveform-canvas-wrap" id="waveformCont">
            <canvas id="waveform"></canvas>
            <!-- Ahora los controles de zoom estÃ¡n fuera del Ã¡rea scrolleable -->
        </div>
        <div class="zoom-controls" id="zoomControls" style="position:fixed; top:120px; right:35px; z-index:999;">
            <button id="zoomout">âˆ’</button>
            <span id="zoomval">1.0x</span>
            <button id="zoomin">+</button>
        </div>
        <div class="graph-wrap" id="bpmGraphCont"><canvas id="bpmGraph"></canvas></div>
        <div class="durcompas-wrap" id="durCompasGraphCont"><canvas id="durCompasGraph"></canvas></div>
        <section class="playback-controls-row">
            <button id="play" disabled>â–¶ï¸ Play</button>
            <button id="pause" disabled>â¸ï¸ Pause</button>
            <button id="stop" disabled>â¹ï¸ Stop</button>
            <label><span>Vol. mÃºsica:</span> <input type="range" id="mainVol" min="0" max="1" step="0.01" value="1"></label>
            <label><span>Vol. metrÃ³nomo:</span> <input type="range" id="metroVol" min="0" max="1" step="0.01"></label>
            <button id="metroBtn" style="background:#333;">ğŸ”ˆ MetrÃ³nomo</button>
            <label>
            <span>Velocidad:</span>
            <input type="number" id="playbackRate" min="0.3" max="2" step="0.1" value="1.0" style="width:55px; margin-left:6px;">
            </label>
        </section>
        <section class="side-data">
            <div class="data-panel">
                <span>Tiempo actual: <b id="currentTime">0.00</b>s</span>
                <span>DuraciÃ³n: <b id="duration">0.00</b>s</span>
                <span>Marcas: <b id="countMarkers">0</b></span>
                <span>BPM Prom: <b id="avgBpm">--</b></span>
            </div>
            <b style="display:block; margin-bottom:8px;">Marcas:</b>
            <div class="marker-list" id="markerList"></div>
        </section>
    </main>
    <div id="fragmentDialogRoot"></div>
    <script src="/js/tempo-map.js"></script>
</body>
</html>
